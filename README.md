# 思考が見える日記（Supabase × Streamlit）

「出来事 → 感情 → 解釈 → 欲求 → 次の行動」を1分で整理し、あとから振り返れる日記アプリです。  
データは Supabase（PostgreSQL）に保存されるため、Streamlitアプリが休止しても記録が消えません。  
また外部Web API（Open-Meteo）を使って、熊本（熊本大学周辺）の天気・気温を自動で取得し、感情との関係を分析できます。

---

## アプリURL（試用はこちら）

- **App:**https://blank-app-e7j78n6hss6.streamlit.app/#956d221d

※上のURLは自分のアプリURLに置き換えてください。

---

## 主な機能

### 1. 日記の記録（入力 → 保存）
以下を入力して保存できます。

- 日付
- 出来事（必須）
- 感情（カテゴリ選択）
- 感情の強度（0〜10）
- 解釈
- 欲求
- 次の行動（小さく具体的に）

保存時に、**熊本（熊本大学周辺）の天気情報を外部Web APIから取得して同時に保存**します。

---

### 2. ダッシュボード
- **今週のふりかえり（7日）**
  - 記録日数
  - 最多の感情
  - 平均強度
- **次の行動リスト**
  - 「次の行動」だけを抽出して一覧表示（実行に移しやすくする）

---

### 3. 最近の記録（30日）
直近30日分の記録を表形式で確認できます。

---

### 4. 詳細表示（1件の思考フロー）
IDを選ぶと、その記録を以下の流れで表示します。

- 出来事  
  ↓  
- 感情（強度）  
  ↓  
- 解釈  
  ↓  
- 欲求  
  ↓  
- 次の行動

また、選択した記録の **熊本の天気（カテゴリ）と気温**も表示します。  
削除機能（確認付き）もあります。

---

### 5. 可視化・分析（期間別）
表示期間（7/14/30/60/90日）を選んで分析できます。

- 感情強度の推移（折れ線）
- 感情カテゴリの回数（横棒グラフ）
- **天気カテゴリ別：平均強度（棒グラフ）**
- **平均気温 × 強度（散布図）**

---

## 使用技術

- Streamlit（UI）
- Supabase（PostgreSQL / 永続化DB）
- Open-Meteo（外部Web API：熊本の天気・気温取得）
- pandas / matplotlib（集計・可視化）

---

## データの保存（Supabase）

本アプリは `entries` テーブルに記録を保存します。  
外部Web APIから取得した天気情報も同じ行に保存します。

例：追加される列
- `weather_code`（天気コード）
- `temp_max`（最高気温）
- `temp_min`（最低気温）

---

## 外部Web APIについて（Open-Meteo）

- API: Open-Meteo（archive API）
- 用途: 日記の記録日ごとの「熊本の天気・気温」を取得
- 取得地点: 熊本大学（黒髪キャンパス付近）の緯度経度を固定

---

## AIの使い方（簡単なメモ）

開発では生成AIを使って以下を進めました。

- sqlite3版の日記アプリを **Supabase版（永続DB）に書き換え**
- Streamlit のUI改善（カード風レイアウト、ダッシュボード構成）
- RLS設定やエラー（RLS policy / secrets / indent）を原因から切り分けて修正
- 外部Web API（Open-Meteo）を追加し、天気×感情の分析を設計

---

## よくあるトラブル

- Supabaseの `RLS` がONだと insert が失敗する場合があります  
  → 課題条件に従い、RLSはOFFで運用しました。

- Streamlit Cloudで `secrets` が未設定だと起動時に `KeyError` になります  
  → `st.secrets["connections"]["supabase"]` を参照しています。

---

## ライセンス
個人課題用（学習用）として作成。
